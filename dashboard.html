<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üíé Premium Dashboard ‚Äî 90 Days Earnings</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
/* === Same CSS as before === */
body { font-family:'Roboto',sans-serif; background:#f2f2f2; color:#222; margin:0; padding:0;}
.navbar { background:linear-gradient(90deg,#c9c9c9,#e6e6e6); padding:12px 20px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 8px rgba(0,0,0,0.25); position:sticky; top:0; z-index:100; }
.navbar h1 { margin:0; font-size:1.5rem; font-weight:700; color:#333; letter-spacing:1px; }
.navbar .nav-right { display:flex; align-items:center; gap:20px; }
.navbar .bell { font-size:1.5rem; cursor:pointer; position:relative; color:#444; }
.navbar .bell::after { content:''; width:8px; height:8px; background:red; border-radius:50%; position:absolute; top:2px; right:2px; }
.navbar .hamburger { font-size:1.8rem; cursor:pointer; color:#333; display:block; }

/* Sidebar */
.sidebar { position:fixed; top:0; left:-100%; width:260px; height:100%; background:linear-gradient(180deg,#dcdcdc,#f5f5f5); padding:25px 20px; display:flex; flex-direction:column; gap:15px; overflow-y:auto; box-shadow: 2px 0 8px rgba(0,0,0,0.2); transition:left 0.3s ease; z-index:300; }
.sidebar a { text-decoration:none; color:#222; font-weight:500; padding:12px 14px; border-radius:8px; transition:0.3s; }
.sidebar a:hover { background:#999; color:#fff; }
.sidebar.show { left:0; }

/* Overlay */
.overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.45); z-index:200; display:none; }
.overlay.active { display:block; }

/* Main Content */
.main-content { padding:20px; transition:0.3s; }

/* Summary Cards */
.summary { display:flex; flex-wrap:wrap; gap:20px; margin-bottom:20px; }
.card { background:linear-gradient(135deg,#e8e8e8,#cfcfcf); padding:20px; border-radius:14px; box-shadow:0 4px 14px rgba(0,0,0,0.2); flex:1 1 220px; text-align:center; transition:0.3s; }
.card:hover { transform:translateY(-5px); box-shadow:0 8px 18px rgba(0,0,0,0.3); }
.card h3 { font-size:1rem; margin-bottom:8px; font-weight:500; color:#444; }
.card p { font-size:1.3rem; font-weight:700; color:#000; }

/* Filters */
.filters { margin-bottom:15px; display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
.filters label { font-weight:500; }
.filters input, .filters button { padding:7px 12px; border-radius:8px; border:1px solid #ccc; background:#f2f2f2; color:#222; }
.filters button { background:#999; color:#fff; font-weight:600; cursor:pointer; }
.filters button:hover { background:#777; }

/* Table */
.table-container { background:#f9f9f9; padding:15px; border-radius:12px; box-shadow:0 4px 14px rgba(0,0,0,0.2); }
table { width:100%; border-collapse:collapse; }
th, td { padding:10px; text-align:center; border-bottom:1px solid #ccc; }
th { background:#e6e6e6; color:#333; font-weight:600; }

/* Pagination */
.pagination { margin-top:15px; display:flex; justify-content:center; gap:8px; flex-wrap:wrap; }
.page-btn { padding:8px 14px; border-radius:8px; border:none; background:#ddd; color:#222; cursor:pointer; transition:0.3s; }
.page-btn:hover { background:#999; color:#fff; }
.page-btn.active { background:#999; color:#fff; }

/* Notifications Panel */
#notificationsPanel { position:fixed; top:0; right:-350px; width:300px; height:100%; background:#f5f5f5; box-shadow:-2px 0 10px rgba(0,0,0,0.3); padding:20px; transition:right 0.3s ease; overflow-y:auto; z-index:400; }
#notificationsPanel.show { right:0; }
#notificationsPanel h2 { margin:0 0 15px 0; font-size:1.3rem; color:#333; display:flex; align-items:center; justify-content:space-between; }
#notificationsPanel .back-btn { font-size:1rem; cursor:pointer; color:#333; background:none; border:none; }
.notification-item { padding:12px; border-radius:10px; margin-bottom:12px; background:#e6e6e6; cursor:pointer; transition:0.3s; }
.notification-item.unread { font-weight:600; background:#d9d9d9; border-left:4px solid #999; }
.notification-item:hover { background:#ccc; }

@media(max-width:992px){ .summary { flex-direction:column; } #notificationsPanel { width:260px; } }
</style>
</head>
<body>

<!-- Navbar -->
<div class="navbar">
  <h1>üíé Premium Dashboard</h1>
  <div class="nav-right">
      <span class="bell" title="Notifications" onclick="toggleNotifications()">&#128276;</span>
      <div class="hamburger" id="hamburger">&#9776;</div>
  </div>
</div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
    <a href="dashboard">üè† Dashboard</a>
    <a href="links">üîó Links</a>
    <a href="withdrawal">üíµ Withdrawal</a>
    <a href="support">üì© Support</a>
    <a href="announcements">üì¢ Announcements</a>
    <a href="profile">üë§ Profile</a>
    <a href="settings">‚öôÔ∏è Settings</a>
    <a href="#" id="logoutBtn" style="color:#b30000;">üö™ Logout</a>
</div>

<!-- Overlay -->
<div class="overlay" id="overlay"></div>

<!-- Main Content -->
<div class="main-content" id="mainContent">
  <div class="summary">
    <div class="card"><h3>Daily Income</h3><p id="dailyIncome">$0</p></div>
    <div class="card"><h3>Total Earnings</h3><p id="totalEarnings">$0</p></div>
    <div class="card"><h3>Total Withdrawal</h3><p id="totalWithdrawal">$0</p></div>
    <div class="card"><h3>Total Available</h3><p id="totalAvailable">$0</p></div>
  </div>

  <div class="filters">
      <label>From: <input type="date" id="fromDate"></label>
      <label>To: <input type="date" id="toDate"></label>
      <button onclick="applyFilter()">Apply</button>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr><th>Date</th><th>Impressions</th><th>Earnings ($)</th><th>CPM ($)</th></tr>
      </thead>
      <tbody id="dataTable"></tbody>
    </table>
    <div class="pagination" id="pagination"></div>
  </div>
</div>

<!-- Notifications -->
<div id="notificationsPanel">
  <h2>
    Notifications
    <button class="back-btn" onclick="toggleNotifications()">‚Üê Back</button>
  </h2>
  <div id="notificationsList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";
import { fetchAndDecryptConfig } from "./config.js";

document.addEventListener("DOMContentLoaded", async () => {
  const firebaseConfig = await fetchAndDecryptConfig();
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  // Sidebar toggle
  const sidebar=document.getElementById('sidebar');
  const overlay=document.getElementById('overlay');
  document.getElementById('hamburger').addEventListener('click',()=>{sidebar.classList.toggle('show');overlay.classList.toggle('active');});
  overlay.addEventListener('click',()=>{sidebar.classList.remove('show');overlay.classList.remove('active');});

  // Notifications
  window.toggleNotifications=()=>{document.getElementById('notificationsPanel').classList.toggle('show');};
  function renderNotifications(notifications){
    const container=document.getElementById('notificationsList');
    container.innerHTML='';
    notifications.forEach(n=>{
      const div=document.createElement('div');
      div.className='notification-item'+(n.read===false?' unread':'');
      div.innerText=n.title?`${n.title}: ${n.message}`:n.message;
      div.onclick=()=>{n.read=true;div.classList.remove('unread');};
      container.appendChild(div);
    });
  }

  // Table + pagination
  window.rowsPerPage=10; window.currentPage=1; window.filteredData=[];
  function renderTable(page){
    const start=(page-1)*window.rowsPerPage, end=start+window.rowsPerPage;
    const rows=window.filteredData.slice(start,end);
    const tbody=document.getElementById('dataTable');
    tbody.innerHTML='';
    rows.forEach(r=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${r.date}</td><td>${r.impressions||0}</td><td>$${r.earnings||0}</td><td>$${r.cpm||0}</td>`;
      tbody.appendChild(tr);
    });
    renderPagination();
  }
  function renderPagination(){
    const totalPages=Math.ceil(window.filteredData.length/window.rowsPerPage);
    const container=document.getElementById('pagination'); container.innerHTML='';
    for(let i=1;i<=totalPages;i++){
      const btn=document.createElement('button');
      btn.className='page-btn'+(i===window.currentPage?' active':''); btn.innerText=i;
      btn.onclick=()=>{window.currentPage=i; renderTable(i);};
      container.appendChild(btn);
    }
  }
  window.applyFilter=()=>{
    const from=document.getElementById('fromDate').value;
    const to=document.getElementById('toDate').value;
    window.filteredData=window.fullData.filter(d=>{
      if(from && d.date<from) return false;
      if(to && d.date>to) return false;
      return true;
    });
    window.currentPage=1; renderTable(1);
  };

  // Fetch dashboard data
  async function fetchDashboardData(userId){
    const userRef=ref(db,`child_panel/${userId}`);
    const snapshot=await get(userRef);
    if(snapshot.exists()){
      const userData=snapshot.val();
      const summary=userData.dashboard.summary;
      document.getElementById('dailyIncome').innerText=`$${summary.dailyIncome||0}`;
      document.getElementById('totalEarnings').innerText=`$${summary.totalEarnings||0}`;
      document.getElementById('totalWithdrawal').innerText=`$${summary.totalWithdrawal||0}`;
      document.getElementById('totalAvailable').innerText=`$${summary.totalAvailable||0}`;
      const dailyStats=userData.dashboard.dailyStats;
      window.fullData=Object.keys(dailyStats).map(d=>({date:d,...dailyStats[d]}));
      window.fullData.sort((a,b)=> new Date(b.date)-new Date(a.date));
      window.filteredData=[...window.fullData];
      renderTable(1);
      renderNotifications(Object.values(userData.notifications||{}));
    }
  }

  // Auth check
  onAuthStateChanged(auth,user=>{
    if(user){
      const userId=user.email.replace(/\./g,'_');
      fetchDashboardData(userId);
    }else{
      window.location.href="login";
    }
  });

  // Logout
  document.getElementById('logoutBtn').addEventListener('click',async()=>{
    try{await signOut(auth); window.location.href="login.html";}catch(err){alert("Logout failed");}
  });
});
</script>
</body>
</html>


